<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Printing Dimensional Inaccuracy Survey & Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .tab-active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        /* Styles for the custom message box */
        #message-box {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <header class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 text-center">Causes of Dimensional Inaccuracy in 3D Printing</h1>
        </header>

        <!-- Tabs -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex justify-center space-x-4 sm:space-x-8" aria-label="Tabs">
                    <button id="form-tab" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Survey Form
                    </button>
                    <button id="dashboard-tab" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg tab-active">
                        Results Dashboard
                    </button>
                </nav>
            </div>
        </div>

        <!-- Form Content -->
        <div id="form-content" class="hidden">
            <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg border-t-8 border-indigo-600">
                <h2 class="text-xl font-semibold text-gray-700 mb-2">Survey on 3D Printing Inaccuracies</h2>
                <p class="text-gray-600 mb-6">Please rate the impact of the following potential causes on the dimensional inaccuracy of 3D prints. All questions are required.</p>
                
                <!-- Message Box for notifications -->
                <div id="message-box" class="hidden p-4 mb-4 text-sm rounded-lg" role="alert">
                  <span class="font-medium" id="message-content"></span>
                </div>

                <form id="survey-form" class="space-y-8">
                    <!-- Form questions will be dynamically inserted here -->
                </form>
                <div class="mt-8 text-center">
                    <button id="submit-button" type="button" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-300">
                        Submit Responses
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard-content">
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg lg:col-span-2">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Overall Impact Analysis</h3>
                    <div class="chart-container" style="height: 500px;">
                        <canvas id="causesChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Top 5 Critical Causes</h3>
                     <div class="chart-container" style="height: 400px;">
                        <canvas id="criticalCausesChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Overall Response Distribution</h3>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
             </div>
        </div>
    </div>

    <script>
        // Data from the provided CSV file (will be updated by form submissions)
        const surveyData = [
            { "Cause": "Flow Rate", "Critical": 46, "Moderate": 4, "Low": 0 },
            { "Cause": "Vibration", "Critical": 16, "Moderate": 25, "Low": 9 },
            { "Cause": "Temperature", "Critical": 44, "Moderate": 6, "Low": 0 },
            { "Cause": "Thermal Expansion", "Critical": 15, "Moderate": 25, "Low": 10 },
            { "Cause": "Filament Inconsistency", "Critical": 42, "Moderate": 8, "Low": 0 },
            { "Cause": "Print Speed", "Critical": 44, "Moderate": 6, "Low": 0 },
            { "Cause": "Nozzle Diameter", "Critical": 11, "Moderate": 30, "Low": 9 },
            { "Cause": "Print Orientation", "Critical": 15, "Moderate": 29, "Low": 6 },
            { "Cause": "Retraction", "Critical": 8, "Moderate": 28, "Low": 14 },
            { "Cause": "Bad Maintenance", "Critical": 16, "Moderate": 24, "Low": 10 },
            { "Cause": "Bed Levelling", "Critical": 46, "Moderate": 4, "Low": 0 },
            { "Cause": "Calibrate the Extruder", "Critical": 43, "Moderate": 7, "Low": 0 },
            { "Cause": "Room Temperature", "Critical": 2, "Moderate": 11, "Low": 37 },
            { "Cause": "Humidity", "Critical": 3, "Moderate": 10, "Low": 37 }
        ];

        let charts = {}; // Object to hold chart instances

        function destroyCharts() {
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
        }

        document.addEventListener('DOMContentLoaded', () => {
            const formTab = document.getElementById('form-tab');
            const dashboardTab = document.getElementById('dashboard-tab');
            const formContent = document.getElementById('form-content');
            const dashboardContent = document.getElementById('dashboard-content');
            const surveyForm = document.getElementById('survey-form');
            const submitButton = document.getElementById('submit-button');
            const messageBox = document.getElementById('message-box');
            const messageContent = document.getElementById('message-content');

            // --- DYNAMICALLY GENERATE THE FORM ---
            function generateForm() {
                surveyForm.innerHTML = '';
                surveyData.forEach((item, index) => {
                    const questionBlock = document.createElement('div');
                    questionBlock.className = 'p-6 rounded-lg border border-gray-200';
                    questionBlock.id = `question-block-${index}`;

                    const questionTitle = document.createElement('p');
                    questionTitle.className = 'font-medium text-gray-800 mb-4';
                    questionTitle.textContent = `${index + 1}. ${item.Cause}`;
                    questionBlock.appendChild(questionTitle);
                    
                    const optionsContainer = document.createElement('div');
                    optionsContainer.className = 'space-y-3';

                    ['Critical', 'Moderate', 'Low'].forEach(level => {
                        const optionId = `q${index}-${level.toLowerCase()}`;
                        const wrapper = document.createElement('div');
                        wrapper.className = 'flex items-center';
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.id = optionId;
                        radioInput.name = `question_${index}`;
                        radioInput.value = level;
                        radioInput.className = 'h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500';
                        const label = document.createElement('label');
                        label.htmlFor = optionId;
                        label.textContent = level;
                        label.className = 'ml-3 block text-sm font-medium text-gray-700';
                        wrapper.appendChild(radioInput);
                        wrapper.appendChild(label);
                        optionsContainer.appendChild(wrapper);
                    });
                    questionBlock.appendChild(optionsContainer);
                    surveyForm.appendChild(questionBlock);
                });
            }

            // --- HANDLE FORM SUBMISSION ---
            function handleSubmit() {
                const formData = new FormData(surveyForm);
                const totalQuestions = surveyData.length;
                let answeredQuestions = 0;
                
                // Reset styles
                document.querySelectorAll('.border-red-400').forEach(el => el.classList.remove('border-red-400'));

                // Validation
                for(let i = 0; i < totalQuestions; i++) {
                    if(formData.has(`question_${i}`)) {
                        answeredQuestions++;
                    } else {
                        // Highlight unanswered questions
                        document.getElementById(`question-block-${i}`).classList.add('border-red-400');
                    }
                }

                if (answeredQuestions < totalQuestions) {
                    showMessage('Error! Please answer all questions before submitting.', 'error');
                    return;
                }

                // Process valid data
                for(let i = 0; i < totalQuestions; i++) {
                    const answer = formData.get(`question_${i}`);
                    if (answer) {
                        surveyData[i][answer]++;
                    }
                }

                // Provide feedback and update UI
                showMessage('Success! Your responses have been recorded.', 'success');
                surveyForm.reset();
                setTimeout(() => {
                    showDashboard();
                }, 1500); // Wait a moment before switching tabs
            }

            // --- CUSTOM MESSAGE DISPLAY ---
            function showMessage(message, type = 'success') {
                messageContent.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
                if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                } else {
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                }
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000); // Hide message after 3 seconds
            }

            // --- CREATE THE DASHBOARD CHARTS ---
            function createAllCharts() {
                destroyCharts();
                createMainBarChart();
                createTopCriticalChart();
                createDistributionChart();
            }

            function createMainBarChart() {
                const ctx = document.getElementById('causesChart').getContext('2d');
                charts.mainBar = new Chart(ctx, {
                    type: 'bar', data: { labels: surveyData.map(item => item.Cause), datasets: [ { label: 'Critical', data: surveyData.map(item => item.Critical), backgroundColor: 'rgba(239, 68, 68, 0.7)' }, { label: 'Moderate', data: surveyData.map(item => item.Moderate), backgroundColor: 'rgba(251, 191, 36, 0.7)' }, { label: 'Low', data: surveyData.map(item => item.Low), backgroundColor: 'rgba(34, 197, 94, 0.7)' } ] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { stacked: true, title: { display: true, text: 'Number of Responses' } }, y: { stacked: true } }, plugins: { legend: { position: 'top' }, tooltip: { mode: 'index', intersect: false } } }
                });
            }

            function createTopCriticalChart() {
                const sortedData = [...surveyData].sort((a, b) => b.Critical - a.Critical).slice(0, 5);
                const ctx = document.getElementById('criticalCausesChart').getContext('2d');
                charts.topCritical = new Chart(ctx, {
                    type: 'bar', data: { labels: sortedData.map(item => item.Cause), datasets: [{ label: 'Critical Responses', data: sortedData.map(item => item.Critical), backgroundColor: 'rgba(220, 38, 38, 0.75)', borderColor: 'rgba(220, 38, 38, 1)', borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Number of Critical Ratings' } } }, plugins: { legend: { display: false } } }
                });
            }

            function createDistributionChart() {
                const totalCritical = surveyData.reduce((sum, item) => sum + item.Critical, 0);
                const totalModerate = surveyData.reduce((sum, item) => sum + item.Moderate, 0);
                const totalLow = surveyData.reduce((sum, item) => sum + item.Low, 0);
                const ctx = document.getElementById('distributionChart').getContext('2d');
                charts.distribution = new Chart(ctx, {
                    type: 'doughnut', data: { labels: ['Critical', 'Moderate', 'Low'], datasets: [{ data: [totalCritical, totalModerate, totalLow], backgroundColor: ['rgba(239, 68, 68, 0.7)', 'rgba(251, 191, 36, 0.7)', 'rgba(34, 197, 94, 0.7)'], borderColor: ['#fff'], borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });
            }

            // --- TAB SWITCHING LOGIC ---
            function showForm() {
                formContent.classList.remove('hidden');
                dashboardContent.classList.add('hidden');
                formTab.classList.add('tab-active');
                formTab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                dashboardTab.classList.remove('tab-active');
                dashboardTab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            }

            function showDashboard() {
                formContent.classList.add('hidden');
                dashboardContent.classList.remove('hidden');
                dashboardTab.classList.add('tab-active');
                dashboardTab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                formTab.classList.remove('tab-active');
                formTab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                createAllCharts();
            }

            // --- EVENT LISTENERS ---
            formTab.addEventListener('click', showForm);
            dashboardTab.addEventListener('click', showDashboard);
            submitButton.addEventListener('click', handleSubmit);

            // --- INITIALIZE ---
            generateForm();
            showDashboard();
        });
    </script>

</body>
</html>
 
